<!-- Baseado em: Jogo Pong (http://gamedeveloper.com.br/blog/2013/08/21/pong-html5-javascript/) -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>HTML5 - Canvas API</title>
<style type="text/css">
canvas {
	border: 1px dashed #ffffff;
	background: #000000;
}
</style>
<script src="desenho.js"></script>
<script src="colisao.js"></script>
</head>
<body onload="init()">
	<canvas id="canvas" width="800" height="768">
                        Navegador não compatível com HTML5 Canvas
                </canvas>
	<script>
            // Variáveis globais utilizadas no jogo
            var canvas, context, w, h, barraWidth, barraHeight, jogadorPosX, jogadorPosY, 
            	bolaRaio, bolaPosX, bolaPosY, bolaParaCima, bolaAngulo, bolaTempo, vidas, fase,
                velocidadeJogador, velocidadeBola, pontos, teclaEsquerdaPressionada, teclaDireitaPressionada,
                bordaW, dy, initDx, initDy, qtdLinhas, qtdColunas, blocoW, blocoH;
            
            function bloco(x, y, style){
            		this.x = x;
            		this.y = y;
            		this.style = style;
            		this.w  = 40;
            		this.h = 20;
            		this.vivo=true;
            }
            
            var blocos = [];
            var styles = ["#FF1493", "#EE1289", "#FFA500", "#FF8C00", "#9ACD32", "#1E90FF"]
            
            // Método para iniciar o jogo, executado no onload da tag body
            function init() {
            	canvas = document.getElementById("canvas");// procura o canvas
            	context = canvas.getContext("2d");// recupera o contexto 2d
            	w = canvas.width;
            	h = canvas.height;
				barraWidth = 80; barraHeight = 14;
				bordaW = barraWidth/2;
				dy = 100;
				initDy = dy+3*bordaW;
				initDx = bordaW;
				qtdLinhas = 6;
				qtdColunas = 18;
				blocoW = 40;
				blocoH = 20;
				jogadorPosX = (canvas.width - barraWidth) / 2;
				jogadorPosY = (canvas.height - barraHeight);
				teclaDireitaPressionada = false; teclaEsquerdaPressionada = false;
				bolaRaio = 8; bolaPosX = canvas.width / 2; bolaPosY = canvas.height / 2;
				bolaParaCima = false;
				bolaAngulo = Math.floor(Math.random() * 21) - 10;
				bolaTempo = 0;
				velocidadeJogador = 10;
				velocidadeBola = 10;
				pontos = 0;
				vidas=5;
				fase = 1;
				
				initBlocos();
				
				document.addEventListener('keyup', keyUp, false);// adiciona evento para keyup
				document.addEventListener('keydown', keyDown, false);// adiciona evento para keydown
				setInterval(gameLoop, 30);// chama a function gameLoop a cada 30 frames
			}
            
			function keyDown(e) {
				if (e.keyCode == 37) { // left
					teclaEsquerdaPressionada = true;
				} else if (e.keyCode == 39) { // right
					teclaDireitaPressionada = true;
				}
			}

			function keyUp(e) {
				if (e.keyCode == 37) { // left
					teclaEsquerdaPressionada = false; // jogador soltou a tecla esquerda
				} else if (e.keyCode == 39) { // right
					teclaDireitaPressionada = false; // jogador soltou a tecla direita
				}
			}
			
			function gameLoop() {
				// Jogador
				if (teclaDireitaPressionada != teclaEsquerdaPressionada) { // se o jogador estiver pressionando a tecla left ou right
					if (teclaEsquerdaPressionada) { // se for para esquerda...
						if (jogadorPosX > 0 + bordaW) { // se não sair da tela...
							jogadorPosX -= velocidadeJogador;// muda a posição
						}
					} else { // se for para direita...
						if (jogadorPosX < (canvas.width - bordaW - barraWidth)) {// se não sair da tela...
							jogadorPosX += velocidadeJogador;// muda a posição
						}
					}
				}

				// Bola
				if (bolaTempo <= 0) {// se a bola estiver em jogo, o tempo é zero	
					verificarColisao();
					
					if (bolaParaCima) {// se a bola estiver indo para cima...
						bolaPosY -= velocidadeBola;// movemos a bola para cima
					} else {// se estiver indo para baixo...
						bolaPosY += velocidadeBola;// movemos a bola para baixo
					}
				}
	
				if ( perdeuVida() ) {// se a bola saiu da tela...
					if (bolaTempo >= 50) {// se so tempo de deixar a bola invisível passou...
						vidas --;
	
						bolaPosX = canvas.width / 2;// posiciona a bola no meio da tela
						bolaPosY = canvas.height / 2;// posiciona a bola no meio da tela
						bolaParaCima = false;// faz ela ir em direção ao jogador
						bolaAngulo = Math.floor(Math.random() * 21) - 10;// faz a bola ir para uma direção aleatória
						bolaTempo = 0;// zera o tempo de deixar a bola invisível e a coloca em jogo novamente   
					} else {// se o tempo de deixar a bola invisível ainda não passou...
						bolaTempo++;// continuamos contando até 50
					}
				}
				// Desenha tudo na tela
				context.clearRect(0, 0, canvas.width, canvas.height);// limpa a tela antes de desenhar
				//placar
				atualizarPlacar();
				//borda
				desenharBorda();
				// Jogador
				desenharBarra();
				//blocos
				desenharBlocos();
				// Bola
				desenharBola();
		}
	</script>
</body>
</html>